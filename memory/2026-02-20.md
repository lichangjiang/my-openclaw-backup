# 2026-02-20

## OpenClaw Cron Payload Types

### systemEvent vs agentTurn 实现区别

**核心区别总结：**
- **systemEvent**: 简单文本事件，只在主会话内处理
- **agentTurn**: 完整代理运行，在隔离会话中执行

**类型定义：**
- systemEvent: `{kind: "systemEvent", text: string}`
- agentTurn: `{kind: "agentTurn", message: string, model?, thinking?, timeoutSeconds?, ...}`

**强制约束（assertSupportedJobSpec）：**
- `sessionTarget="main"` → 必须使用 `systemEvent`
- `sessionTarget="isolated"` → 必须使用 `agentTurn`

**执行流程：**
- systemEvent: `enqueueSystemEvent()` → 主会话心跳时处理
- agentTurn: `runIsolatedAgentJob()` → 独立会话完整代理执行

**交付能力：**
- systemEvent: 不支持 delivery 配置，只能通过主会话代理的消息工具发送
- agentTurn: 支持 delivery 配置（announce/direct），可交付到外部渠道

**源码位置：**
- 类型定义: `src/cron/types.ts`
- 约束检查: `src/cron/service/jobs.ts` (assertSupportedJobSpec)
- 执行逻辑: `src/cron/service/timer.ts` (executeJobCore)
- agentTurn实现: `src/cron/isolated-agent/run.ts`

**关键文件路径：**
- OpenClaw 源码: `/home/lichangjiang/project/openclaw/src/`
- Cron 服务: `src/cron/service/`
