# 2026-02-16

## OneDrive 配置和整理方案

### OneDrive 客户端安装和配置

**安装信息：**
- 客户端：onedrive-cli (Snap v2.5.9)
- 安装方式：`sudo snap install onedrive-cli`
- 安装时间：2026-02-16 07:38 UTC

**认证配置：**
- 认证方式：OAuth2（网页授权）
- 授权完成：2026-02-16 08:04 UTC
- 刷新令牌：已生成并保存
- 重定向 URL：用户提供的重定向 URL

**同步配置：**
- 同步目录：`~/onedrive`
- 配置文件：`~/snap/onedrive-cli/40/.config/onedrive/config`
- 数据库：`~/snap/onedrive-cli/40/.config/onedrive/items.sqlite3`
- 后台服务：已启动（进程 ID：801343）

**同步状态：**
- 状态：正在同步中
- 已同步目录：
  - `books/`
  - `bookxnote/`
  - `env/`
  - `notes/`
  - `new-note/`
  - `linuxSS/`
  - `电信/`
  - `附件/`

**功能特性：**
- ✅ 多端共享：自动同步到 OneDrive
- ✅ 双向同步：本地和远程保持一致
- ✅ 实时监控：文件变化 5 分钟内自动同步
- ✅ 选择性同步：支持排除特定文件和目录
- ✅ 冲突保护：当本地和远程同时修改时，创建本地备份

**使用方式：**
- 查看同步目录：`ls -lh ~/onedrive`
- 查看同步日志：`tail -f ~/onedrive.log`
- 查看同步状态：`/snap/bin/onedrive-cli --display-sync-status`

---

## OpenWrt 软路由配置

### 网络信息

- IP 地址：192.168.1.201
- SSH 端口：22（开放）
- 网络延迟：1.4-2.1 ms（正常）
- 连接状态：✅ 正常

### SSH 配置

**用户名：** root（密码认证已验证）

**密码：** 9kON!ZXq3RyxZ5（已确认正确）

**SSH 公钥认证：**
- ❌ **失败**（Dropbear 固件版本过旧）
- 错误信息：`Pubkey auth attempt with unknown algo for 'root'`
- 公钥位置：`/etc/dropbear/authorized_keys`
- 根本原因：Dropbear 不支持现代 SSH 客户端的 RSA 签名算法（rsa-sha2-256）

**Dropbear 配置：**
```
dropbear.@dropbear[0]=dropbear
dropbear.@dropbear[0].PasswordAuth='on'
dropbear.@dropbear[0].Port='22'
dropbear.@dropbear[0].Interface='lan'
```

**解决方法：**
- ✅ 当前：使用密码认证（工作正常）
- ⚠️ 长期：升级 OpenWrt 固件以支持 SSH 公钥认证

**SSH 管理命令：**
```bash
# 密码认证（推荐，当前唯一可靠方法）
sshpass -p '9kON!ZXq3RyxZ5' ssh root@192.168.1.201 <command>

# 交互式登录
ssh root@192.168.1.201

# 查看系统信息
sshpass -p '9kON!ZXq3RyxZ5' ssh root@192.168.1.201 'uname -a; df -h; free -m'
```

---

## OneDrive 目录整理方案

### 用户需求

**核心要求：**
- 合并 `notes/` 和 `new-note/` 的内容
- 在 `notes/` 内部建立清晰的分类结构
- 不改变其他顶级目录
- 只在 `notes/` 内部整理和合并

**用户偏好：**
- 希望两个目录下面相似内容都能放到合理的分类目录下
- 不希望现有的 `notes/` 目录被完全改变
- 希望先在新目录中看到整理效果，再决定是否统一整理

### 整理方案

#### 目标目录结构

```
~/onedrive/auto-notes/
├── 📁 Projects/               # 项目笔记
│   ├── 💻 Coding/
│   │   ├── ☁️ Cloud/
│   │   ├── 🔧 Tools/
│   │   ├── 📊 Data/
│   │   └── 📦 IDE/
│   ├── 📝 Personal/
│   │   ├── 📖 Journal/
│   │   ├── 📚 Study/
│   │   ├── 💡 Ideas/
│   │   └── 📄 Archives/
│   ├── 🎯 Learning/
│   ├── 🔧 Environment/
│   │   ├── 💻 Linux/
│   │   ├── ☁️ Cloud/
│   │   ├── 📦 IDE/
│   │   ├── 💾 WSL/
│   │   └── 💻 Tmux/
│   └── 🗂️ OldNotes/             # 旧笔记备份
```

#### 目录映射

**从 notes/ 到 auto-notes/Projects/Coding：**
```
notes/jupyter/          → auto-notes/Projects/Learning/Jupyter/
notes/python/            → auto-notes/Projects/Learning/Python/
notes/k8s/               → auto-notes/Projects/Coding/Cloud/K8s/
notes/graphql/           → auto-notes/Projects/Coding/GraphQL/
notes/java/              → auto-notes/Projects/Coding/Java/
notes/pingcode/          → auto-notes/Projects/Data/PingCode/
```

**从 notes/ 到 auto-notes/Environment/：**
```
notes/.vscode            → auto-notes/Environment/VSCode/
notes/wsl环境配置        → auto-notes/Environment/WSL/
```

**从 notes/ 到 auto-notes/Projects/Data/Math：**
```
notes/数学/                → auto-notes/Projects/Data/Learning/Math/
```

**从 notes/ 到 auto-notes/Archives/Drafts：**
```
notes/草稿/                → auto-notes/Archives/Drafts/
```

**从 new-note/ 到 auto-notes/Projects/Learning：**
```
new-note/jupyter/        → auto-notes/Projects/Learning/Jupyter/
new-note/python/          → auto-notes/Projects/Learning/Python/
new-note/ppt/            → auto-notes/Projects/Learning/Presentation/PPT/
```

#### 整理策略

**1. 不改变原始目录**
- `notes/` 目录保持不变
- `new-note/` 目录保持不变
- 所有整理操作都在 `auto-notes/` 中进行

**2. 安全复制文件**
- 使用 `rsync -av --delete` 复制（保留源文件）
- 不会删除任何原始文件
- 原始目录可以随时访问

**3. 创建完整备份**
- `auto-notes/OldNotes/Backup_notes/` - `notes/` 的完整备份
- `auto-notes/OldNotes/Backup_new-note/` - `new-note/` 的完整备份
- 如果不满意，可以手动删除 `auto-notes/` 目录

**4. 生成索引文件**
- 在 `auto-notes/README.md` 中记录：
  - 整理时间和方法
  - 完整目录结构树
  - 文件统计（总文件数、总目录数）
  - 操作日志（rsync 命令执行记录）

**5. 分类逻辑**

**Projects 类别判断：**
- jupyter, python - Learning 类（学习工具）
- k8s, graphql, java, pingcode - Coding 类（项目笔记）
- .vscode - Environment 类（IDE 配置）
- 数学 - Data 类（学习资料）

**Learning 类别细化：**
- Jupyter 笔记 - 学习笔记
- Python 笔记 - 学习笔记
- PPT 资料 - 演示文稿

**Data 类别：**
- pingcode - 项目笔记
- 数学 - 学习资料

---

## 自动整理脚本

### 脚本信息

**位置：** `/home/lichangjiang/.openclaw/workspace/auto_organize.sh`
**执行权限：** `chmod +x`

### 脚本功能

**1. 预览模式（--dry-run）**
- 只显示将要执行的操作
- 不实际移动任何文件
- 创建完整的目录结构和索引

**2. 实际模式（默认）**
- 安全地移动所有文件
- 使用 `rsync -av --delete` 复制（保留源文件）
- 创建清晰的目录结构
- 生成索引和统计信息

**3. 一次性执行**
- 系统定时器配置为单次执行
- 执行时间：2026-02-17 01:00 UTC（北京时间 09:00）
- 执行后自动停止（不重复）

### 脚本特性

**安全机制：**
- ✅ 使用 rsync 复制（保留源文件）
- ✅ 不删除原始文件
- ✅ 创建完整备份
- ✅ 详细的操作日志

**灵活性：**
- ✅ 支持手动编辑目录分类逻辑
- ✅ 支持查看详细日志和统计
- ✅ 可以随时回滚（删除 auto-notes/ 目录）

---

## News Aggregator Skills

### 查找结果

**可用的新闻聚合 Skills：**

| Skill 名称 | 开发者 | 安装数 | 描述 |
|-----------|--------|--------|------|
| **news-aggregator-skill** | mclank | 589 | 新闻聚合主技能 |
| **rss-aggregator** | zephyrwang6 | 25 | RSS 聚合器 |
| **intent-signal-aggregator** | monewave-ai | 24 | 意图信号聚合 |

**推荐 Skill：** news-aggregator-skill

**理由：**
- 安装数最多（589），说明经过充分测试
- 功能最全面（新闻聚合、阅读统计、历史记录）
- 活跃维护

---

## 系统环境和配置

### OpenClaw 服务器

**操作系统：** Ubuntu 24.04.2 LTS (Noble Numbat)
**内核：** 6.8.0-64-generic
**环境：** 无图形界面（headless Linux server）
**Sudo：** 无需密码（已确认）

### Kubernetes 集群

**集群：** microk8s v1.28.15（snap）
**地址：** https://10.0.0.23:16443
**上下文：** microk8s
**用户：** lichangjiang

### 工作目录

**Workspace：** `/home/lichangjiang/.openclaw/workspace`
**主项目目录：** `~/project`

### 已安装的工具和技能

**文档处理技能：**
1. docx - Word 文档处理
2. pdf - PDF 文件处理
3. pptx - PowerPoint 演示文稿处理
4. xlsx - Excel 表格处理

**Python 依赖：**
- pypdf 6.7.0
- pdfplumber 0.11.9
- pandas 3.0.0
- openpyxl 3.1.5
- markitdown 0.1.4

**系统工具：**
- pandoc 3.1.3
- LibreOffice 24.2.7.2
- docx 9.5.3 (npm)

**OneDrive 客户端：**
- onedrive-cli (Snap v2.5.9)
- 配置文件：`~/snap/onedrive-cli/40/.config/onedrive/config`
- 同步目录：`~/onedrive`

---

## 任务和提醒配置

### Cron 任务列表

**1. 每日技术摘要推送** ⭐⭐⭐（最重要）
- 任务 ID：40c0b192-29af-4a9c-827a-d1a32e1e5edf
- 推送时间：每天 22:30（北京时间）
- 状态：✅ 成功
- 功能：推送 RSS 订阅内容，个性化推荐

**2. 用户偏好数据自动归档** ⭐⭐⭐
- 任务 ID：612fedfc-4e45-497d-a3a1-28fbf8cb34a2
- 归档周期：每 180 天（约 6 个月）
- 状态：✅ 成功
- 功能：归档 180 天前的点击记录

**3. OpenSpec 学习系列** ⭐⭐⭐
- OpenSpec Day 1-2：概念理解 ✅
- OpenSpec Day 3-4：目录结构 ✅
- OpenSpec Day 7：深入原理 ✅
- OpenSpec Day 5-6 学习提醒 ✅
- OpenSpec Day 7 学习主题 ✅
- 状态：部分成功（最后一个学习主题失败）

**4. OpenSpec Day 1-2 学习提醒：概念理解**
- 任务 ID：5d92276...
- 状态：❌ 失败（Cron announce delivery failed）
- 错误：Cron 任务配置错误

**5. OneDrive 一次性整理** ⚠️ 需确认
- 任务 ID：c952b3bb...
- 状态：❌ 失败（Cron announce delivery failed）
- 执行时间：明天凌晨 1:00（北京时间 09:00）
- 功能：合并 notes/ 和 new-note/，创建 auto-notes/ 目录

**6. OneDrive 自动归档** ⚠️ 需确认
- 任务 ID：612fedfc...
- 状态：❌ 失败（Cron announce delivery failed）
- 错误：Cron announce delivery failed

**7. 用户偏好数据自动归档** ⚠️ 需确认
- 任务 ID：5d92276...
- 状态：✅ 成功
- 执行时间：每 180 天
- 功能：归档 180 天前的点击记录

**8. OneDrive 一次性整理** ⚠️ 需确认
- 任务 ID：c952b3bb...
- 状态：❌ 失败（Cron announce delivery failed）
- 错误：Cron announce delivery failed

**9. OneDrive 一次性整理**
- 任务 ID：5d92276...
- 状态：✅ 成功
- 执行时间：每 6 个月
- 功能：归档 180 天前的点击记录

---

## 重要决策和配置

### 用户决策

**RSS 订阅方案：** 用户选择了 RSS 订阅方案
- 理由：更简单可靠，无需 API 密钥管理

**数据存储策略：** 用户选择了全量保留模式（2026-02-16）
- 理由：本地机器内存和存储充足，支持长期分析

**OneDrive 整理方案：** 用户同意在新目录中测试效果
- 理由：先在 `auto-notes/` 中实现新方案
- 要求：整理后不改变 notes/ 和 new-note/
- 计划：明天凌晨 1 点执行第一次整理

**OpenWrt SSH：** 用户决定延迟（2026-02-16）
- 理由：可能需要升级固件以支持 SSH 公钥认证
- 当前方案：使用密码认证（工作正常）

**News Aggregator：** 用户要求查找新闻手机相关技能
- 已找到：news-aggregator-skill, rss-aggregator, intent-signal-aggregator
- 推荐安装：news-aggregator-skill

---

## 待办事项

- [x] OneDrive 客户端安装和配置
- [x] 创建自动整理脚本
- [x] 创建一次性定时器（明天凌晨 1 点执行）
- [x] 查找 News Aggregator 相关技能
- [x] OpenWrt SSH 密码认证配置
- [ ] Reddit 登录解决方案（已延迟）
- [ ] 考虑是否需要将 JSON 数据迁移到 SQLite（长期）
- [ ] OpenWrt 固件升级计划

---

## 每日技术摘要系统问题修复（紧急）

### 问题描述

**用户反馈：** "我也没有收到今日的技术摘要推送"（2026-02-16 16:00 UTC）

**问题诊断：**
1. ✅ Cron 任务存在且定时正确（每天 22:30 北京时间）
2. ❌ 推送失败：`lastStatus: "error"`, `lastError: "cron announce delivery failed"`
3. ❌ 脚本文件缺失：`daily_tech_digest_system.py` 不存在于 workspace
4. ❌ 推送机制故障：OpenClaw cron 的 announce 功能无法正常发送到 Feishu

### 解决措施

**1. 重建推送脚本**
- 文件：`/home/lichangjiang/.openclaw/workspace/daily_tech_digest_system.py`
- 功能：从 RSS 源获取文章、多维度评分、动态推荐比例
- 状态：✅ 创建成功

**2. 安装依赖**
- `pip3 install feedparser --break-system-packages`
- 状态：✅ 成功安装

**3. 手动触发测试**
- 测试模式：`python3 daily_tech_digest_system.py --test`
- 结果：✅ 成功获取 RSS 源并生成摘要

**4. 手动推送成功**
- 方式：直接调用 `message` 工具发送到 Feishu
- 时间：2026-02-16 16:15 UTC
- 结果：✅ 成功发送，用户收到

### Cron 推送失败分析

**根本原因：**
OpenClaw 的 cron announce delivery 机制与 Feishu 集成存在故障

**错误信息：**
```
cron announce delivery failed
consecutiveErrors: 1
```

**Cron 任务配置：**
- Job ID: 40c0b192-29af-4a9c-827a-d1a32e1e5edf
- Schedule: `30 14 * * *` (14:30 UTC, 22:30 Beijing time)
- Session target: isolated
- Payload: configured but delivery failed
- Enabled: true

### 解决方案

**方案 1：修改脚本直接调用 OpenClaw API（推荐）**
- 在脚本中添加 `sessions_send` 或 `message` 工具调用
- 脚本生成摘要后直接发送到 Feishu
- 不依赖 cron 的 announce 功能
- 优点：完全控制推送流程，可靠性高
- 缺点：需要修改脚本代码

**方案 2：手动触发每天推送**
- 每天 22:30 由我手动运行脚本
- 使用 `message` 工具直接推送
- 优点：快速解决，无需修改代码
- 缺点：需要人工介入，不够自动化

**当前状态：**
- ✅ 脚本已创建并测试成功
- ✅ 手动推送成功验证
- ⚠️ 自动推送仍需修复
- ⏳ 等待用户选择方案

### 用户确认

**用户要求：** "我希望我的定时任务都正常，而不是删除"

这意味着用户希望：
- 所有 cron 任务保持启用状态
- 自动推送功能正常工作
- 不接受删除任务作为解决方案
